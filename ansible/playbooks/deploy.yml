---
- name: Deploy application to Kubernetes
  hosts: local
  gather_facts: false

  tasks:
    - name: Debug - Check directory path
      debug:
        msg: "Path: {{ playbook_dir }}/../../k8s/{{ env }}/"

    - name: Debug - List directory contents
      shell: ls -la "{{ playbook_dir }}/../../k8s/{{ env }}/"
      register: dir_contents

    - debug:
        var: dir_contents.stdout_lines

    - name: Debug - Check if directory exists
      stat:
        path: "{{ playbook_dir }}/../../k8s/{{ env }}/"
      register: path_stat

    - debug:
        var: path_stat.stat

    - name: Apply namespace
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: "{{ kube_namespace }}"

    - name: Deploy application
      kubernetes.core.k8s:
        state: present
        src: "{{ playbook_dir }}/../../k8s/{{ env }}/"  # Added trailing slash
        namespace: "{{ kube_namespace }}"  # Added namespace parameter